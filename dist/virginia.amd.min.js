/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

!function(e,n){"function"==typeof define&&define.amd?define(["jquery","underscore","backbone","handlebars"],n):e.Virginia=n(e.$,e._,e.Backbone,e.Handlebars)}(this,function(e,n,t,r){var i,o,s;return function(e){function n(e,n){return y.call(e,n)}function t(e,n){var t,r,i,o,s,a,c,l,u,f,d,h,p=n&&n.split("/"),m=w.map,_=m&&m["*"]||{};if(e){for(e=e.split("/"),s=e.length-1,w.nodeIdCompat&&k.test(e[s])&&(e[s]=e[s].replace(k,"")),"."===e[0].charAt(0)&&p&&(h=p.slice(0,p.length-1),e=h.concat(e)),u=0;u<e.length;u++)if(d=e[u],"."===d)e.splice(u,1),u-=1;else if(".."===d){if(0===u||1===u&&".."===e[2]||".."===e[u-1])continue;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}if((p||_)&&m){for(t=e.split("/"),u=t.length;u>0;u-=1){if(r=t.slice(0,u).join("/"),p)for(f=p.length;f>0;f-=1)if(i=m[p.slice(0,f).join("/")],i&&(i=i[r])){o=i,a=u;break}if(o)break;!c&&_&&_[r]&&(c=_[r],l=u)}!o&&c&&(o=c,a=l),o&&(t.splice(0,a,o),e=t.join("/"))}return e}function r(n,t){return function(){var r=x.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),p.apply(e,r.concat([n,t]))}}function a(e){return function(n){return t(n,e)}}function c(e){return function(n){g[e]=n}}function l(t){if(n(v,t)){var r=v[t];delete v[t],b[t]=!0,h.apply(e,r)}if(!n(g,t)&&!n(b,t))throw new Error("No "+t);return g[t]}function u(e){var n,t=e?e.indexOf("!"):-1;return t>-1&&(n=e.substring(0,t),e=e.substring(t+1,e.length)),[n,e]}function f(e){return e?u(e):[]}function d(e){return function(){return w&&w.config&&w.config[e]||{}}}var h,p,m,_,g={},v={},w={},b={},y=Object.prototype.hasOwnProperty,x=[].slice,k=/\.js$/;m=function(e,n){var r,i=u(e),o=i[0],s=n[1];return e=i[1],o&&(o=t(o,s),r=l(o)),o?e=r&&r.normalize?r.normalize(e,a(s)):t(e,s):(e=t(e,s),i=u(e),o=i[0],e=i[1],o&&(r=l(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:r}},_={require:function(e){return r(e)},exports:function(e){var n=g[e];return"undefined"!=typeof n?n:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:d(e)}}},h=function(t,i,o,s){var a,u,d,h,p,w,y,x=[],k=typeof o;if(s=s||t,w=f(s),"undefined"===k||"function"===k){for(i=!i.length&&o.length?["require","exports","module"]:i,p=0;p<i.length;p+=1)if(h=m(i[p],w),u=h.f,"require"===u)x[p]=_.require(t);else if("exports"===u)x[p]=_.exports(t),y=!0;else if("module"===u)a=x[p]=_.module(t);else if(n(g,u)||n(v,u)||n(b,u))x[p]=l(u);else{if(!h.p)throw new Error(t+" missing "+u);h.p.load(h.n,r(s,!0),c(u),{}),x[p]=g[u]}d=o?o.apply(g[t],x):void 0,t&&(a&&a.exports!==e&&a.exports!==g[t]?g[t]=a.exports:d===e&&y||(g[t]=d))}else t&&(g[t]=o)},i=o=p=function(n,t,r,i,o){if("string"==typeof n)return _[n]?_[n](t):l(m(n,f(t)).f);if(!n.splice){if(w=n,w.deps&&p(w.deps,w.callback),!t)return;t.splice?(n=t,t=r,r=null):n=e}return t=t||function(){},"function"==typeof r&&(r=i,i=o),i?h(e,n,t,r):setTimeout(function(){h(e,n,t,r)},4),p},p.config=function(e){return p(e)},i._defined=g,s=function(e,t,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(r=t,t=[]),n(g,e)||n(v,e)||(v[e]=[e,t,r])},s.amd={jQuery:!0}}(),s("../node_modules/almond/almond",function(){}),s("virginia/common",[],function(){var e={escape_html:function(e){return e?e.replace(/[&<"']/g,function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case'"':return"&quot;";default:return"&#039;"}}):e},break_lines:function(e){return e?e.replace(/(?:\r\n|\r|\n)/g,"<br />"):e},money:function(e,t){var r,i={currency:"$",currency_position:"left",thousands_separator:",",rate:""},o=t;return window.SiteSettings&&window.SiteSettings.Currency&&(i=window.SiteSettings.Currency),o=n.mapObject(o,function(e,t){if(n.isNull(e))return i[t]}),o.rate&&o.rate.length&&(e*=parseFloat(o.rate)),r=Math.abs(e).toFixed(3).replace(/\d$/,""),o.thousands_separator&&(r=r.replace(/(\d)(?=(\d{3})+(\.|$))/g,"$1"+o.thousands_separator)),o.currency&&("left"===o.currency_position?r=o.currency+r:r+=o.currency),e<0&&(r="-"+r),r}};return e}),s("virginia/templates",["jquery","handlebars","virginia/common"],function(e,n,t){var r={_html_cache:{},_templates_cache:{},_global_context:{},get:function(t){var i=this._normalize_template_url(t);if(window.JST&&window.JST.hasOwnProperty(i)){var o=window.JST[i],s=e.Deferred();return setTimeout(function(){s.resolve(o)},1),s.promise()}if(r._templates_cache.hasOwnProperty(t)){var o=r._templates_cache[t],a=r._html_cache[t],c=e.Deferred();return setTimeout(function(){c.resolve(o,a)},1),c.promise()}var l=e.Deferred(function(i){e.get(t).done(function(e){r.process_tags(e).done(function(e){var o=n.compile(e);r._html_cache[t]=e,r._templates_cache[t]=o,i.resolve(o,e)})}).fail(function(){throw new Error("Could not load template "+t)})});return l.promise()},preload:function(){var n=[];if(arguments.length>0)for(var t=0;t<arguments.length;t++){var i=arguments[t];n.push(r.get(i))}return e.when.apply(e,n)},render:function(n,t){var i=e.extend({},r._global_context,t);return n(i)},add_to_global_context:function(n){r._global_context=e.extend(r._global_context,n)},_re_include:/\{\{include\s+'([^']+)'\s*\}\}/i,process_tags:function(n){var t=r._re_include.exec(n);if(t){var i=t[0],o=t[1].replace(/\\/g,"/"),s=r._template_url(o),a=e.Deferred(function(e){r.get(s).done(function(e,t){n=n.replace(i,t),r.process_tags(n).done(function(e){a.resolve(e)})})});return a.promise()}return e.Deferred().resolve(n).promise()},_template_url:function(e){return e},_normalize_template_url:function(e){var n="/my/api/2/templates?name=";return e.indexOf(n)>=0?e.replace(n,"templates/"):e},helpers:{raw:function(e){return new n.SafeString(e)},escape:function(e){return encodeURI(e)},unescape:function(e){return decodeURI(e)},eq:function(e,n,t){return e==n?t.fn(this):t.inverse(this)},noeq:function(e,n,t){return e!=n?t.fn(this):t.inverse(this)},break_lines:function(e){return new n.SafeString(t.break_lines(t.escape_html(e)))},condition:function(e,n,t,r){var i=!1;switch(n){case"==":i=e==t;break;case"!=":i=e!=t;break;case">=":case"gte":i=e>=t;break;case">":case"gt":i=e>t;break;case"<=":case"lte":i=e<=t;break;case"<":case"lt":i=e<t;break;default:console.error('condition hb tag: unexpected operator "'+n+'".'),i=!1}return i?r.fn(this):r.inverse(this)},moment:function(e,n){if(!e)throw"Date in not defined for 'moment' Handlebars helper!";if(!window.moment)throw"moment hb helper: moment.js lib is not loaded";var t=new Date(e);return moment(t).format(n)},moment_humanize_duration:function(e,n){if(!e)throw"Date in not defined for 'moment_duration' Handlebars helper!";if(!window.moment)throw"moment hb helper: moment.js lib is not loaded";return e="number"==typeof e?e:parseInt(e),moment.duration(e,n).humanize()},money:function(e,n,r,i,o){return null!=e?e.indexOf&&e.indexOf(".")>=0&&(e=e.replace(/,/g,"")):e=0,t.money(parseFloat(e),{currency:"string"==typeof n?n:null,currency_position:"string"==typeof r?r:null,thousands_separator:"string"==typeof i?i:null,rate:"string"==typeof o?o:null})},percent:function(e){var n=0;return null!=e&&(e.indexOf&&e.indexOf(",")>=0&&(e=e.replace(/,/g,"")),n=Number(e).toFixed(2),n%1===0&&(n=parseInt(e))),n+"%"}},register_helpers:function(){for(var e in this.helpers)n.registerHelper(e,this.helpers[e])},init:function(){this.register_helpers()}};return r}),s("virginia/view",["jquery","handlebars","backbone","virginia/templates"],function(e,t,r,i){var o=r.View.extend({template_name:"please set path to template path",after_initialize:function(){},render:function(e){var n=this;return this._rendered=!1,this.load_template(this.template_name).done(function(e){n._render_template(e)}),this},load_template:function(e){return i.get(e)},_render_template:function(e){var n=this.get_context(),t=this._process_template(e,n);this.template=e,this.$el.html(t),this.delegateEvents(),this.after_render(),this._rendered=!0,this.trigger("rendered")},_process_template:function(e,n){var t=i.render(e,n);return t},html_render:function(e){return this.template(e)},is_rendered:function(){return this._rendered||!1},get_context:function(){return{}},after_render:function(){},focus:function(){this.$("input:first").focus()},bind_selectors:function(){var e=n.result(this,"base_selectors",{}),t=n.result(this,"selectors",{}),r=n.extend({},e,t);for(var i in r)r.hasOwnProperty(i)&&(this["$"+i]=this.$(r[i]))},show:function(){this.$el.show()},hide:function(){this.$el.hide()},clear:function(){this.undelegateEvents(),this.stopListening(),this.$el&&this.$el.length>0&&this.$el.empty(),this.trigger("destroy")}});return o}),s("virginia/model-view",["virginia/view"],function(e){var n=e.extend({initialize:function(e){this.options=e,this.fetch_model=!1,this.create_model(e),this.fetch_and_render(),this.after_initialize()},create_model:function(e){if(!this.model){if(!e.model_id)throw"Virginia.BaseModelView needs model or model_id";var n=e.model_class||this.model_class;if(!n)throw"Virginia.BaseModelView needs model_class";var t=n.prototype.idAttribute,r={};r[t]=e.model_id,this.model=new n(r,e.model_options||{}),this.fetch_model=!0}},fetch_and_render:function(){this.fetch_model?(this.model.fetch().done(function(){this.render()}.bind(this)),this.fetch_model=!1):this.render()},get_context:function(){return{model:this.model.toJSON()}}});return n}),s("virginia/collection-view",["virginia/view"],function(e){return BaseCollectionView=e.extend({initialize:function(e){if(this.options=e,this.collection)this.render();else{var n=e.collection_class||this.collection_class;if(!n)throw"Virginia.BaseCollectionView.initialize needs collection_class";this.collection=new n([],e.collection_options||{}),this.fetch_and_render()}this.after_initialize()},fetch_and_render:function(){this.collection.fetch().done(function(){this.render()}.bind(this))},get_context:function(){return{collection:this.collection.toJSON()}}}),BaseCollectionView}),s("virginia",["virginia/templates","virginia/view","virginia/model-view","virginia/collection-view","virginia/common"],function(e,n,t,r,i){"use strict";var o={Templates:e,BaseView:n,BaseModelView:t,BaseCollectionView:r,Common:i};return o.Templates.init(),o}),s("jquery",function(){return e}),s("underscore",function(){return n}),s("backbone",function(){return t}),s("handlebars",function(){return r}),o("virginia")});